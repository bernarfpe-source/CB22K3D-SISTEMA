<!DOCTYPE html>
<HTML LANG="PT-BR">
<HEAD>
    <META CHARSET="UTF-8">
    <STYLE>
        /* PADRONIZAÇÃO VISUAL CB2K */
        * { BOX-SIZING: BORDER-BOX; TEXT-TRANSFORM: UPPERCASE; FONT-FAMILY: 'SEGUE UI', SANS-SERIF; }
        BODY { BACKGROUND-COLOR: #F0F2F5; MARGIN: 0; PADDING: 20px; }
        .CARD { BACKGROUND: WHITE; PADDING: 20px; BORDER-RADIUS: 12px; MARGIN-BOTTOM: 20px; BOX-SHADOW: 0 2PX 10PX RGBA(0,0,0,0.05); }
        
        /* TABELA CONFORME IMAGEM */
        TABLE { WIDTH: 100%; BORDER-COLLAPSE: COLLAPSE; MARGIN-TOP: 10px; }
        TH { BACKGROUND: #F8FAFC; PADDING: 15px; TEXT-ALIGN: LEFT; COLOR: #475569; FONT-SIZE: 12px; BORDER-BOTTOM: 2PX SOLID #E2E8F0; }
        TD { PADDING: 15px; BORDER-BOTTOM: 1px SOLID #F1F5F9; FONT-SIZE: 13px; COLOR: #1E293B; }

        /* INPUTS E BOTOES */
        .GRID-ENTRADA { DISPLAY: GRID; GRID-TEMPLATE-COLUMNS: 2FR 1FR 1FR; GAP: 15px; MARGIN-BOTTOM: 15px; }
        .GRUPO-INPUT { DISPLAY: FLEX; FLEX-DIRECTION: COLUMN; }
        LABEL { FONT-SIZE: 11px; FONT-WEIGHT: BOLD; COLOR: #64748B; MARGIN-BOTTOM: 5px; }
        INPUT { PADDING: 12px; BORDER: 1px SOLID #E2E8F0; BORDER-RADIUS: 8px; BACKGROUND: #F8FAFC; }
        
        .BTN-ADICIONAR { BACKGROUND: #3B82F6; COLOR: WHITE; BORDER: NONE; PADDING: 12px; BORDER-RADIUS: 8px; CURSOR: POINTER; FONT-WEIGHT: BOLD; MARGIN-TOP: 18px; }
        .BTN-REMOVER { COLOR: #EF4444; BORDER: NONE; BACKGROUND: NONE; CURSOR: POINTER; FONT-WEIGHT: BOLD; }

        /* DISPLAY DE VALOR FINAL */
        .CARD-PRECO-AZUL { BACKGROUND: #EBF2FF; BORDER: 2px SOLID #3B82F6; BORDER-RADIUS: 10px; PADDING: 25px; TEXT-ALIGN: CENTER; }
        #VALOR_FINAL_DISPLAY { FONT-SIZE: 50px; COLOR: #3B82F6; FONT-WEIGHT: BOLD; MARGIN: 0; }
    </STYLE>
</HEAD>
<BODY>

    <DIV CLASS="CONTAINER">
        <H2>SISTEMA DE ORÇAMENTO CB2K</H2>

        <DIV CLASS="CARD">
            <DIV CLASS="GRID-ENTRADA" STYLE="GRID-TEMPLATE-COLUMNS: 3FR 1FR;">
                <DIV CLASS="GRUPO-INPUT">
                    <LABEL>CLIENTE</LABEL>
                    <INPUT TYPE="TEXT" ID="CLIENTE_NOME" ONINPUT="ATUALIZAR_DADOS()">
                </DIV>
                <DIV CLASS="GRUPO-INPUT">
                    <LABEL>WA</LABEL>
                    <INPUT TYPE="TEXT" ID="CLIENTE_WA" ONINPUT="ATUALIZAR_DADOS()">
                </DIV>
            </DIV>
        </DIV>

        <DIV CLASS="CARD">
            <DIV CLASS="GRID-ENTRADA">
                <DIV CLASS="GRUPO-INPUT">
                    <LABEL>NOME DA PEÇA</LABEL>
                    <INPUT TYPE="TEXT" ID="PECA_NOME" PLACEHOLDER="DIGITE O NOME">
                </DIV>
                <DIV CLASS="GRUPO-INPUT">
                    <LABEL>CUSTO BASE (R$)</LABEL>
                    <INPUT TYPE="NUMBER" ID="PECA_CUSTO" VALUE="0">
                </DIV>
                <BUTTON CLASS="BTN-ADICIONAR" ONCLICK="ADICIONAR_ITEM_TABELA()">ADICIONAR AO ORÇAMENTO</BUTTON>
            </DIV>
        </DIV>

        <DIV CLASS="CARD">
            <TABLE>
                <THEAD>
                    <TR>
                        <TH>PEÇA</TH>
                        <TH>MATERIAIS</TH>
                        <TH>CUSTO BASE</TH>
                        <TH>AÇÃO</TH>
                    </TR>
                </THEAD>
                <TBODY ID="CORPO_TABELA">
                    </TBODY>
            </TABLE>
        </DIV>

        <DIV CLASS="CARD">
            <DIV CLASS="GRID-ENTRADA" STYLE="GRID-TEMPLATE-COLUMNS: REPEAT(5, 1FR);">
                <DIV CLASS="GRUPO-INPUT"><LABEL>IMP %</LABEL><INPUT TYPE="NUMBER" ID="T_IMP" VALUE="6" ONINPUT="CALCULAR_TUDO()"></DIV>
                <DIV CLASS="GRUPO-INPUT"><LABEL>MKT %</LABEL><INPUT TYPE="NUMBER" ID="T_MKT" VALUE="0" ONINPUT="CALCULAR_TUDO()"></DIV>
                <DIV CLASS="GRUPO-INPUT"><LABEL>EMBALAGEM</LABEL><INPUT TYPE="NUMBER" ID="T_EMB" VALUE="5" ONINPUT="CALCULAR_TUDO()"></DIV>
                <DIV CLASS="GRUPO-INPUT"><LABEL>FRETE</LABEL><INPUT TYPE="NUMBER" ID="T_FRETE" VALUE="0" ONINPUT="CALCULAR_TUDO()"></DIV>
                <DIV CLASS="GRUPO-INPUT"><LABEL>MARGEM %</LABEL><INPUT TYPE="NUMBER" ID="T_MARGEM" VALUE="100" ONINPUT="CALCULAR_TUDO()"></DIV>
            </DIV>

            <DIV CLASS="CARD-PRECO-AZUL">
                <H1 ID="VALOR_FINAL_DISPLAY">R$ 0,00</H1>
                <SPAN ID="INFO_CLIENTE" STYLE="FONT-SIZE: 12PX; COLOR: #3B82F6;"></SPAN>
            </DIV>
        </DIV>
    </DIV>

    <SCRIPT>
        // ESTADO GLOBAL DO ORÇAMENTO
        LET LISTA_PECAS = [];
        LET DADOS_CLIENTE = { NOME: "", WA: "" };

        FUNCTION ATUALIZAR_DADOS() {
            DADOS_CLIENTE.NOME = DOCUMENT.GETELEMENTBYID('CLIENTE_NOME').VALUE.TOUPPERCASE();
            DADOS_CLIENTE.WA = DOCUMENT.GETELEMENTBYID('CLIENTE_WA').VALUE;
            DOCUMENT.GETELEMENTBYID('INFO_CLIENTE').INNERTEXT = "CLIENTE: " + DADOS_CLIENTE.NOME;
        }

        // FUNÇÃO QUE FAZ A PEÇA CONSTAR NA TABELA
        FUNCTION ADICIONAR_ITEM_TABELA() {
            CONST NOME = DOCUMENT.GETELEMENTBYID('PECA_NOME').VALUE;
            CONST CUSTO = PARSEFLOAT(DOCUMENT.GETELEMENTBYID('PECA_CUSTO').VALUE) || 0;

            IF (NOME === "") {
                ALERT("DIGITE O NOME DA PEÇA!");
                RETURN;
            }

            // ADICIONA AO ARRAY
            LISTA_PECAS.PUSH({ NOME: NOME.TOUPPERCASE(), CUSTO: CUSTO });

            // LIMPA ENTRADA
            DOCUMENT.GETELEMENTBYID('PECA_NOME').VALUE = "";
            DOCUMENT.GETELEMENTBYID('PECA_CUSTO').VALUE = "0";

            RENDERIZAR_TABELA();
            CALCULAR_TUDO();
        }

        FUNCTION RENDERIZAR_TABELA() {
            CONST TBODY = DOCUMENT.GETELEMENTBYID('CORPO_TABELA');
            TBODY.INNERHTML = ""; // RESET VISUAL

            LISTA_PECAS.FOREACH((ITEM, INDEX) => {
                CONST LINHA = TBODY.INSERTROW();
                LINHA.INNERHTML = `
                    <TD>${ITEM.NOME}</TD>
                    <TD>IMPRESSÃO 3D</TD>
                    <TD>R$ ${ITEM.CUSTO.FIXED(2)}</TD>
                    <TD><BUTTON CLASS="BTN-REMOVER" ONCLICK="REMOVER_ITEM(${INDEX})">REMOVER</BUTTON></TD>
                `;
            });
        }

        FUNCTION CALCULAR_TUDO() {
            LET SOMA_BASE = LISTA_PECAS.REDUCE((ACC, I) => ACC + I.CUSTO, 0);
            
            CONST IMP = PARSEFLOAT(DOCUMENT.GETELEMENTBYID('T_IMP').VALUE) / 100;
            CONST MKT = PARSEFLOAT(DOCUMENT.GETELEMENTBYID('T_MKT').VALUE) / 100;
            CONST EMB = PARSEFLOAT(DOCUMENT.GETELEMENTBYID('T_EMB').VALUE) || 0;
            CONST FRETE = PARSEFLOAT(DOCUMENT.GETELEMENTBYID('T_FRETE').VALUE) || 0;
            CONST MARGEM = PARSEFLOAT(DOCUMENT.GETELEMENTBYID('T_MARGEM').VALUE) / 100;

            LET SUBTOTAL = SOMA_BASE + EMB + FRETE;
            LET TOTAL = (SUBTOTAL * (1 + IMP + MKT)) * (1 + MARGEM);

            DOCUMENT.GETELEMENTBYID('VALOR_FINAL_DISPLAY').INNERTEXT = "R$ " + TOTAL.FIXED(2);
        }

        FUNCTION REMOVER_ITEM(INDEX) {
            LISTA_PECAS.SPLICE(INDEX, 1);
            RENDERIZAR_TABELA();
            CALCULAR_TUDO();
        }
    </SCRIPT>
</BODY>
</HTML>

