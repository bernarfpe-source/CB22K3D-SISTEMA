<DIV CLASS="CONTAINER-ORCAMENTO">
    
    <DIV CLASS="CARD-CLIENTE">
        <DIV CLASS="GRUPO-INPUT">
            <LABEL>CLIENTE</LABEL>
            <INPUT TYPE="TEXT" ID="CLIENTE_NOME" PLACEHOLDER="NOME DO CLIENTE">
        </DIV>
        <DIV CLASS="GRUPO-INPUT">
            <LABEL>WA</LABEL>
            <INPUT TYPE="TEXT" ID="CLIENTE_WA" PLACEHOLDER="WHATSAPP">
        </DIV>
    </DIV>

    <DIV CLASS="CARD-ADICIONAR">
        <DIV CLASS="GRID-INPUTS">
            <DIV CLASS="GRUPO-INPUT">
                <LABEL>PEÇA</LABEL>
                <INPUT TYPE="TEXT" ID="INPUT_PECA" PLACEHOLDER="NOME DA PEÇA">
            </DIV>
            <DIV CLASS="GRUPO-INPUT">
                <LABEL>CUSTO MATERIAL (R$)</LABEL>
                <INPUT TYPE="NUMBER" ID="CUSTO_MATERIAL" VALUE="0">
            </DIV>
            <BUTTON CLASS="BTN-CALCULAR" ONCLICK="CALCULAR_E_ADICIONAR()">ADICIONAR ITEM</BUTTON>
        </DIV>
    </DIV>

    <DIV CLASS="CARD-TABELA">
        <TABLE CLASS="TABELA-ORCAMENTO">
            <THEAD>
                <TR>
                    <TH>PEÇA</TH>
                    <TH>MATERIAIS</TH>
                    <TH>CUSTO BASE</TH>
                    <TH>AÇÃO</TH>
                </TR>
            </THEAD>
            <TBODY ID="CORPO_TABELA">
                </TBODY>
        </TABLE>
    </DIV>

    <DIV CLASS="CARD-TAXAS">
        <DIV CLASS="GRID-TAXAS">
            <DIV CLASS="GRUPO-INPUT">
                <LABEL>IMP %</LABEL>
                <INPUT TYPE="NUMBER" ID="TAXA_IMP" VALUE="6">
            </DIV>
            <DIV CLASS="GRUPO-INPUT">
                <LABEL>MKT %</LABEL>
                <INPUT TYPE="NUMBER" ID="TAXA_MKT" VALUE="0">
            </DIV>
            <DIV CLASS="GRUPO-INPUT">
                <LABEL>EMBALAGEM</LABEL>
                <INPUT TYPE="NUMBER" ID="VALOR_EMBALAGEM" VALUE="5">
            </DIV>
            <DIV CLASS="GRUPO-INPUT">
                <LABEL>FRETE</LABEL>
                <INPUT TYPE="NUMBER" ID="VALOR_FRETE" VALUE="0">
            </DIV>
            <DIV CLASS="GRUPO-INPUT">
                <LABEL>MARGEM %</LABEL>
                <INPUT TYPE="NUMBER" ID="TAXA_MARGEM" VALUE="100">
            </DIV>
        </DIV>

        <DIV CLASS="CARD-PRECO-FINAL">
            <H1 ID="DISPLAY_TOTAL">R$ 0,00</H1>
        </DIV>
    </DIV>

</DIV>

<SCRIPT>
    // LISTA PARA ARMAZENAR OS ITENS DO ORÇAMENTO
    LET ITENS_ORCAMENTO = [];

    // 1. FUNÇÃO PARA CALCULAR E LANÇAR NA TABELA
    FUNCTION CALCULAR_E_ADICIONAR() {
        CONST NOME = DOCUMENT.GETELEMENTBYID('INPUT_PECA').VALUE;
        CONST CUSTO = PARSEFLOAT(DOCUMENT.GETELEMENTBYID('CUSTO_MATERIAL').VALUE) || 0;

        IF (NOME === "") {
            ALERT("INFORME O NOME DA PEÇA!");
            RETURN;
        }

        // ADICIONA AO ARRAY
        ITENS_ORCAMENTO.PUSH({ NOME: NOME, CUSTO: CUSTO });

        // ATUALIZA A INTERFACE
        RENDERIZAR_TABELA();
        RECALCULAR_TOTAL_GERAL();

        // LIMPA CAMPOS
        DOCUMENT.GETELEMENTBYID('INPUT_PECA').VALUE = "";
        DOCUMENT.GETELEMENTBYID('CUSTO_MATERIAL').VALUE = "0";
    }

    // 2. FUNÇÃO PARA DESENHAR A TABELA
    FUNCTION RENDERIZAR_TABELA() {
        CONST CORPO = DOCUMENT.GETELEMENTBYID('CORPO_TABELA');
        CORPO.INNERHTML = "";

        ITENS_ORCAMENTO.FOREACH((ITEM, INDEX) => {
            CONST LINHA = CORPO.INSERTROW();
            LINHA.INNERHTML = `
                <TD>${ITEM.NOME.TOUPPERCASE()}</TD>
                <TD>FILAMENTO</TD>
                <TD>R$ ${ITEM.CUSTO.FIXED(2)}</TD>
                <TD><BUTTON ONCLICK="REMOVER_ITEM(${INDEX})">REMOVER</BUTTON></TD>
            `;
        });
    }

    // 3. LÓGICA DE CÁLCULO FINAL (SOMA TUDO + TAXAS DA TELA)
    FUNCTION RECALCULAR_TOTAL_GERAL() {
        LET SOMA_BASE = ITENS_ORCAMENTO.REDUCE((ACC, ITEM) => ACC + ITEM.CUSTO, 0);
        
        // CAPTURA TAXAS DA TELA
        CONST IMP = PARSEFLOAT(DOCUMENT.GETELEMENTBYID('TAXA_IMP').VALUE) / 100;
        CONST MKT = PARSEFLOAT(DOCUMENT.GETELEMENTBYID('TAXA_MKT').VALUE) / 100;
        CONST EMB = PARSEFLOAT(DOCUMENT.GETELEMENTBYID('VALOR_EMBALAGEM').VALUE) || 0;
        CONST FRETE = PARSEFLOAT(DOCUMENT.GETELEMENTBYID('VALOR_FRETE').VALUE) || 0;
        CONST MARGEM = PARSEFLOAT(DOCUMENT.GETELEMENTBYID('TAXA_MARGEM').VALUE) / 100;

        // CÁLCULO: (BASE + EMBALAGEM + FRETE) * IMPOSTOS * MARGEM
        LET TOTAL = (SOMA_BASE + EMB + FRETE);
        TOTAL = TOTAL + (TOTAL * IMP) + (TOTAL * MKT);
        TOTAL = TOTAL + (TOTAL * MARGEM);

        DOCUMENT.GETELEMENTBYID('DISPLAY_TOTAL').INNERTEXT = `R$ ${TOTAL.FIXED(2)}`;
    }

    FUNCTION REMOVER_ITEM(INDEX) {
        ITENS_ORCAMENTO.SPLICE(INDEX, 1);
        RENDERIZAR_TABELA();
        RECALCULAR_TOTAL_GERAL();
    }
</SCRIPT>

       
