<!DOCTYPE html>
<HTML LANG="PT-BR">
<HEAD>
    <META CHARSET="UTF-8">
    <TITLE>SISTEMA DE ORÇAMENTO - CB2K</TITLE>
    <STYLE>
        /* ESTILO BASEADO NA IDENTIDADE VISUAL CB2K */
        * { BOX-SIZING: BORDER-BOX; TEXT-TRANSFORM: UPPERCASE; FONT-FAMILY: 'SEGUE UI', SANS-SERIF; }
        BODY { BACKGROUND-COLOR: #F0F2F5; MARGIN: 0; PADDING: 20px; COLOR: #1E293B; }
        .CONTAINER { MAX-WIDTH: 1100px; MARGIN: 0 AUTO; }
        
        /* CARDS E LAYOUT */
        .CARD { BACKGROUND: WHITE; PADDING: 25px; BORDER-RADIUS: 12px; MARGIN-BOTTOM: 20px; BOX-SHADOW: 0 2PX 10PX RGBA(0,0,0,0.05); }
        .GRID-CLIENTE { DISPLAY: GRID; GRID-TEMPLATE-COLUMNS: 3FR 1FR; GAP: 20px; }
        .GRID-ADICIONAR { DISPLAY: GRID; GRID-TEMPLATE-COLUMNS: 2FR 1FR 1FR; GAP: 15px; ALIGN-ITEMS: END; }
        .GRID-TAXAS { DISPLAY: GRID; GRID-TEMPLATE-COLUMNS: REPEAT(5, 1FR); GAP: 10px; }
        
        /* FORMULÁRIOS */
        .GRUPO-INPUT { DISPLAY: FLEX; FLEX-DIRECTION: COLUMN; }
        LABEL { FONT-SIZE: 11px; FONT-WEIGHT: BOLD; COLOR: #64748B; MARGIN-BOTTOM: 5px; }
        INPUT { PADDING: 12px; BORDER: 1px SOLID #E2E8F0; BORDER-RADIUS: 8px; BACKGROUND: #F8FAFC; FONT-WEIGHT: BOLD; }
        
        /* TABELA CENTRAL (REFERENTE À SEGUNDA IMAGEM) */
        TABLE { WIDTH: 100%; BORDER-COLLAPSE: COLLAPSE; MARGIN-TOP: 10px; }
        TH { BACKGROUND: #F8FAFC; PADDING: 15px; TEXT-ALIGN: LEFT; COLOR: #475569; FONT-SIZE: 12px; BORDER-BOTTOM: 2PX SOLID #E2E8F0; }
        TD { PADDING: 15px; BORDER-BOTTOM: 1px SOLID #F1F5F9; FONT-SIZE: 13px; }

        /* BOTOES E DISPLAY FINAL */
        .BTN-ADICIONAR { BACKGROUND: #3B82F6; COLOR: WHITE; BORDER: NONE; PADDING: 12px; BORDER-RADIUS: 8px; CURSOR: POINTER; FONT-WEIGHT: BOLD; }
        .BTN-REMOVER { COLOR: #EF4444; BORDER: NONE; BACKGROUND: NONE; CURSOR: POINTER; FONT-WEIGHT: BOLD; FONT-SIZE: 11px; }
        
        .CARD-TOTAL-AZUL { BACKGROUND: #EBF2FF; BORDER: 2px SOLID #3B82F6; BORDER-RADIUS: 10px; PADDING: 30px; TEXT-ALIGN: CENTER; MARGIN-TOP: 20px; }
        #VALOR_FINAL_DISPLAY { FONT-SIZE: 50px; COLOR: #3B82F6; FONT-WEIGHT: BOLD; MARGIN: 0; }
        #SUBTITULO_CLIENTE { COLOR: #3B82F6; FONT-SIZE: 14px; MARGIN-TOP: 5px; FONT-WEIGHT: BOLD; }
    </STYLE>
</HEAD>
<BODY>

    <DIV CLASS="CONTAINER">
        <H2 ID="TITULO_SISTEMA">ORÇAMENTO - BERNARDINO FILHO</H2>

        <DIV CLASS="CARD">
            <DIV CLASS="GRID-CLIENTE">
                <DIV CLASS="GRUPO-INPUT">
                    <LABEL>CLIENTE</LABEL>
                    <INPUT TYPE="TEXT" ID="CLIENTE_NOME" ONINPUT="VINCULAR_CLIENTE()">
                </DIV>
                <DIV CLASS="GRUPO-INPUT">
                    <LABEL>WA (WHATSAPP)</LABEL>
                    <INPUT TYPE="TEXT" ID="CLIENTE_WA">
                </DIV>
            </DIV>
        </DIV>

        <DIV CLASS="CARD">
            <DIV CLASS="GRID-ADICIONAR">
                <DIV CLASS="GRUPO-INPUT">
                    <LABEL>PEÇA / PRODUTO</LABEL>
                    <INPUT TYPE="TEXT" ID="NOVA_PECA_NOME" PLACEHOLDER="EX: SUPORTE 3D">
                </DIV>
                <DIV CLASS="GRUPO-INPUT">
                    <LABEL>CUSTO BASE (R$)</LABEL>
                    <INPUT TYPE="NUMBER" ID="NOVA_PECA_CUSTO" VALUE="0">
                </DIV>
                <BUTTON CLASS="BTN-ADICIONAR" ONCLICK="ADICIONAR_PRODUTO()">ADICIONAR AO ORÇAMENTO</BUTTON>
            </DIV>
        </DIV>

        <DIV CLASS="CARD">
            <TABLE>
                <THEAD>
                    <TR>
                        <TH>PEÇA</TH>
                        <TH>MATERIAIS</TH>
                        <TH>CUSTO BASE</TH>
                        <TH>AÇÃO</TH>
                    </TR>
                </THEAD>
                <TBODY ID="CORPO_TABELA_ORCAMENTO">
                    </TBODY>
            </TABLE>
        </DIV>

        <DIV CLASS="CARD">
            <DIV CLASS="GRID-TAXAS">
                <DIV CLASS="GRUPO-INPUT"><LABEL>IMP %</LABEL><INPUT TYPE="NUMBER" ID="TAXA_IMP" VALUE="6" ONINPUT="RECALCULAR_TUDO()"></DIV>
                <DIV CLASS="GRUPO-INPUT"><LABEL>MKT %</LABEL><INPUT TYPE="NUMBER" ID="TAXA_MKT" VALUE="0" ONINPUT="RECALCULAR_TUDO()"></DIV>
                <DIV CLASS="GRUPO-INPUT"><LABEL>EMBALAGEM</LABEL><INPUT TYPE="NUMBER" ID="VAL_EMB" VALUE="5" ONINPUT="RECALCULAR_TUDO()"></DIV>
                <DIV CLASS="GRUPO-INPUT"><LABEL>FRETE</LABEL><INPUT TYPE="NUMBER" ID="VAL_FRETE" VALUE="0" ONINPUT="RECALCULAR_TUDO()"></DIV>
                <DIV CLASS="GRUPO-INPUT"><LABEL>MARGEM %</LABEL><INPUT TYPE="NUMBER" ID="TAXA_MARGEM" VALUE="100" ONINPUT="RECALCULAR_TUDO()"></DIV>
            </DIV>

            <DIV CLASS="CARD-TOTAL-AZUL">
                <H1 ID="VALOR_FINAL_DISPLAY">R$ 0,00</H1>
                <DIV ID="SUBTITULO_CLIENTE">AGUARDANDO DADOS...</DIV>
            </DIV>
        </DIV>
    </DIV>

    <SCRIPT>
        // ESTADO DO SISTEMA
        LET LISTA_DE_ITENS = [];

        // FUNÇÃO PARA VINCULAR O NOME DO CLIENTE AO DISPLAY FINAL
        FUNCTION VINCULAR_CLIENTE() {
            CONST NOME = DOCUMENT.GETELEMENTBYID('CLIENTE_NOME').VALUE.TOUPPERCASE();
            DOCUMENT.GETELEMENTBYID('SUBTITULO_CLIENTE').INNERTEXT = NOME ? "ORÇAMENTO PARA: " + NOME : "AGUARDANDO DADOS...";
        }

        // FUNÇÃO QUE REALIZA A TRANSFERÊNCIA PARA A TABELA
        FUNCTION ADICIONAR_PRODUTO() {
            CONST NOME_PECA = DOCUMENT.GETELEMENTBYID('NOVA_PECA_NOME').VALUE;
            CONST CUSTO_VALOR = PARSEFLOAT(DOCUMENT.GETELEMENTBYID('NOVA_PECA_CUSTO').VALUE) || 0;

            IF (NOME_PECA === "") {
                ALERT("POR FAVOR, INFORME O NOME DA PEÇA!");
                RETURN;
            }

            // SALVA NO ARRAY
            LISTA_DE_ITENS.PUSH({
                NOME: NOME_PECA.TOUPPERCASE(),
                CUSTO: CUSTO_VALOR
            });

            // LIMPA INPUTS PARA NOVA ENTRADA
            DOCUMENT.GETELEMENTBYID('NOVA_PECA_NOME').VALUE = "";
            DOCUMENT.GETELEMENTBYID('NOVA_PECA_CUSTO').VALUE = "0";

            RENDERIZAR_TABELA();
            RECALCULAR_TUDO();
        }

        // DESENHA OS ITENS NA TABELA CENTRAL
        FUNCTION RENDERIZAR_TABELA() {
            CONST CORPO = DOCUMENT.GETELEMENTBYID('CORPO_TABELA_ORCAMENTO');
            CORPO.INNERHTML = ""; // LIMPA ANTES DE RECONSTRUIR

            LISTA_DE_ITENS.FOREACH((ITEM, INDEX) => {
                CONST LINHA = CORPO.INSERTROW();
                LINHA.INNERHTML = `
                    <TD>${ITEM.NOME}</TD>
                    <TD>IMPRESSÃO 3D</TD>
                    <TD>R$ ${ITEM.CUSTO.FIXED(2)}</TD>
                    <TD><BUTTON CLASS="BTN-REMOVER" ONCLICK="REMOVER_ITEM(${INDEX})">REMOVER</BUTTON></TD>
                `;
            });
        }

        // LÓGICA DE CÁLCULO FINAL (CB2K)
        FUNCTION RECALCULAR_TUDO() {
            LET SOMA_BASE = LISTA_DE_ITENS.REDUCE((ACC, ITEM) => ACC + ITEM.CUSTO, 0);
            
            // CAPTURA DAS TAXAS DA INTERFACE
            CONST IMP = PARSEFLOAT(DOCUMENT.GETELEMENTBYID('TAXA_IMP').VALUE) / 100;
            CONST MKT = PARSEFLOAT(DOCUMENT.GETELEMENTBYID('TAXA_MKT').VALUE) / 100;
            CONST EMB = PARSEFLOAT(DOCUMENT.GETELEMENTBYID('VAL_EMB').VALUE) || 0;
            CONST FRETE = PARSEFLOAT(DOCUMENT.GETELEMENTBYID('VAL_FRETE').VALUE) || 0;
            CONST MARGEM = PARSEFLOAT(DOCUMENT.GETELEMENTBYID('TAXA_MARGEM').VALUE) / 100;

            // FÓRMULA: (CUSTOS + TAXAS FIXAS) * IMPOSTOS * LUCRO
            LET SUBTOTAL = SOMA_BASE + EMB + FRETE;
            LET TOTAL = (SUBTOTAL * (1 + IMP + MKT)) * (1 + MARGEM);

            DOCUMENT.GETELEMENTBYID('VALOR_FINAL_DISPLAY').INNERTEXT = "R$ " + TOTAL.FIXED(2);
        }

        FUNCTION REMOVER_ITEM(INDEX) {
            LISTA_DE_ITENS.SPLICE(INDEX, 1);
            RENDERIZAR_TABELA();
            RECALCULAR_TUDO();
        }
    </SCRIPT>
</BODY>
</HTML>
